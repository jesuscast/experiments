from dtensor import dtensor
from ktensor import ktensor
from cp import als
import numpy as np

readingsNormalized = np.array([[-0.010636665393776477, -0.011722169854092775, -4.5007422422339124e-05, 0.0106964111328125, -0.0085296630859375, -1.000732421875, 47.534164428710938, 2.71453857421875, -69.607009887695312], [-0.0085805167569009723, -0.010554107574564535, -0.00023020090441903864, 0.010274989812443548, -0.0081620924503874124, -0.99936490252867893, 47.534164428710938, 2.71453857421875, -69.607009887695312], [-0.0085061365217130869, -0.010654774889189016, -2.929477199087162e-05, 0.011236732884457238, -0.0072855328499002656, -1.0005687205347522, 47.60968017578125, 2.863739013671875, -69.758026123046875], [-0.0097009165287331479, -0.010656488066296453, -4.0724352321193546e-05, 0.011444091796875, -0.0068206787109375, -1.0012359619140625, 47.661736816406247, 2.7313200683593748, -69.811054931640626], [-0.0085032755144846279, -0.010544437546885112, -0.0001409962702242833, 0.014589748965992647, -0.0099116421634203762, -1.0012148499569651, 47.757568359375, 2.487548828125, -69.908676147460938], [-0.0084981470384428489, -0.0095977662525365669, -0.0011033476396198284, 0.015106201171875, -0.0092620849609375, -1.0016632080078125, 47.459915161132812, 2.8649444580078125, -69.606597900390625], [-0.011267493740636125, -0.01150245921777053, -0.00016596938824119545, 0.0167999267578125, -0.010955810546875, -1.0004119873046875, 47.459915161132812, 2.8649444580078125, -69.606597900390625], [-0.011063303800407171, -0.011722809012754394, -4.9268480166465911e-05, 0.016401366868778557, -0.0072322568653815991, -1.0006899568799517, 47.460174560546875, 2.93975830078125, -69.6817626953125], [-0.0094174920919013836, -0.011720216352801537, -3.1808238715236032e-05, 0.010825354258401797, -0.0048497479136923273, -1.001495361328125, 47.481460434810614, 2.8690626071369745, -69.661437773762927], [-0.0095594167328394257, -0.011727762492381942, -0.0011028150074018125, 0.007622767281610974, -0.0084286337704359681, -1.001495361328125, 47.556127582687409, 2.7413960575628407, -69.654173297959957], [-0.0095594167328394257, -0.011727762492381942, -0.0011028150074018125, 0.0092315673828125, -0.0104827880859375, -1.0005035400390625, 47.684341430664062, 2.862762451171875, -69.983734130859375], [-0.0094499823330756495, -0.011450963221597051, -0.00099139354322316537, 0.0077889736138501203, -0.0088210298729952032, -1.0015319749613079, 47.684341430664062, 2.862762451171875, -69.983734130859375], [-0.0095611098568617048, -0.011046321799887021, -0.0011061719650788397, 0.0084027891955772947, -0.0075593590034233318, -1.0004476333473455, 47.341291895015537, 2.3556763886373151, -70.315447923992352], [-0.0095648949878743856, -0.011086686193821469, -0.00073007169920359357, 0.010414066347488371, -0.0068482802407035604, -0.99967433733258926, 47.75970458984375, 2.937347412109375, -69.984588623046875], [-0.0084848312329924534, -0.010669155959075444, -0.0021662152306704523, 0.012404304953182444, -0.0073327944224117368, -1.0005457860061027, 47.75965856933594, 2.9140657958984377, -69.937742919921874], [-0.0084848312329924534, -0.010669155959075444, -0.0021662152306704523, 0.0124359130859375, -0.008056640625, -1.0026702880859375, 47.759262084960938, 2.7134857177734375, -69.534149169921875], [-0.0072834379694902774, -0.011717222688224305, -1.1346744444941399e-05, 0.0124359130859375, -0.008056640625, -1.0026702880859375, 47.894230834960936, 2.8469642333984377, -69.602891357421882], [-0.0091434309705690636, -0.011719932798777109, -3.0093720317895403e-05, 0.010181652277166192, -0.0095175858682660913, -1.0021999511718751, 47.909896850585938, 2.862457275390625, -69.610870361328125], [-0.0095658133507779512, -0.011722605621591364, -0.00041148814566337356, 0.010158260140617083, -0.010302795170864024, -1.0016280860835012, 47.609455440967032, 2.7873220460869246, -69.607145824931067], [-0.0094480927051847838, -0.011616459403047603, -0.0011022856921910019, 0.010694405209234429, -0.011550276861006663, -0.99934617396763392, 47.608016967773438, 2.712249755859375, -70.357696533203125], [-0.0095700693771997424, -0.011720571957438728, -3.435477806202217e-05, 0.014129638671875, -0.0065765380859375, -1.0021820068359375, 47.608016967773438, 2.712249755859375, -70.357696533203125], [-0.0085952025401561712, -0.012621574726195529, -1.9819506152668255e-05, 0.013709869031280162, -0.0074166380410138743, -1.000714530874399, 47.529280554420424, 2.8794867777111124, -69.436703432892685], [-0.0085027884466918856, -0.012042700978535159, -2.0139314623308029e-05, 0.01306532824311365, -0.0078729625364365834, -1.0014671130058093, 47.608779907226562, 2.639129638671875, -69.607559204101562], [-0.0084923605220263258, -0.011727366229610485, -0.0010924336053051605, 0.009424169997041449, -0.011889892327054839, -0.99960191374236507, 47.609070499084879, 2.7026102386289703, -69.607676425212603], [-0.0084954838773527701, -0.01066196542413223, -0.0010977550013306619, 0.0089456225198412693, -0.010653831557472153, -1.0010074013157895, 47.601560632894426, 2.7806554483802928, -69.670273026474348], [-0.0084954838773527701, -0.01066196542413223, -0.0010977550013306619, 0.0104522705078125, -0.0070648193359375, -1.0007476806640625, 47.531005859375, 2.2630615234375, -70.206069946289062], [-0.0095529362151478385, -0.010826355224855207, -0.0019736278344936534, 0.013045702707450044, -0.0058593398040464083, -1.0011354493956635, 47.531005859375, 2.2630615234375, -70.206069946289062], [-0.0082862308498655984, -0.010021629304544245, -0.0008160306199262949, 0.012898010534141125, -0.0085409314626190835, -1.0006071908133372, 47.785439506832311, 2.6374654217713531, -69.913810627978776], [-0.007920105855818857, -0.010371962002108961, 0.00038644356165694609, 0.012798972731370192, -0.0099749954578488374, -1.0004884376205316, 47.533554077148438, 2.63916015625, -69.756851196289062], [-0.0085104281216180546, -0.011512741904915993, 0.00073099090893748186, 0.014184424990699405, -0.010271198381696428, -0.9993881196082397, 47.533554077148438, 2.63916015625, -69.756851196289062], [-0.0084954838773527701, -0.01066196542413223, -0.0010977550013306619, 0.0143585205078125, -0.010467529296875, -1.0004425048828125, 47.684646606445312, 2.7888946533203125, -69.533584594726562], [-0.0095620798939295044, -0.010663563320786277, -0.001108407645690979, 0.011532451428865132, -0.0050425436395747057, -0.99999528556034478, 47.547871005559919, 2.8579409211972475, -69.737617549960575], [-0.0088734145733434643, -0.010075076616282005, -0.0011058540036189388, 0.0094976580501600488, -0.0086159912109375, -1.0005023093693048, 47.534683227539062, 2.864166259765625, -69.757308959960938], [-0.0085002762811484233, -0.010378617379206329, -0.00072412360837024981, 0.011374585832868302, -0.0084564208984374972, -1.0014533298732518, 47.534683227539062, 2.864166259765625, -69.757308959960938], [-0.0085982465582192334, -0.011534846725182998, -2.7180290169078206e-05, 0.011732233067071931, -0.0092175971137152778, -1.0009213950417259, 47.533674851204587, 2.7139272759221718, -69.841555405522428], [-0.0095727325382898212, -0.010656372785843063, -3.9947416351188574e-05, 0.0106964111328125, -0.0090179443359375, -1.000732421875, 47.759262084960938, 2.7134857177734375, -69.534149169921875], [-0.0094468749582852611, -0.012577864113668086, -0.00098418022089851462, 0.012750228828669417, -0.0084218174656133203, -1.000938028430622, 47.759262084960938, 2.7134857177734375, -69.534149169921875], [-0.0095599505940305377, -0.011446337650778382, -0.0011045792444428005, 0.012513851983206602, -0.007254471464998415, -0.9997122544095306, 47.273127107281944, 2.7884100745656126, -69.860511900786875], [-0.0092490834495760899, -0.011113977244006057, -0.001105737414305823, 0.011508138508139957, -0.0073964219037224348, -1.0002710711008096, 47.534912109375, 2.864532470703125, -69.607315063476562], [-0.0072831591396892107, -0.010652869812433994, -1.5259342349057517e-05, 0.01295757892370019, -0.0098852714008188514, -1.0006504118546196, 47.534962775243471, 2.8769148245671086, -69.613949019405823], [-0.0095727325382898212, -0.010656372785843063, -3.9947416351188574e-05, 0.012176513671875, -0.0121917724609375, -1.0016632080078125, 47.535537719726562, 3.01434326171875, -69.6826171875], [-0.009555442171029372, -0.013523444173353483, -0.00098259135053154118, 0.013486756329761122, -0.0079791867945117993, -0.99997360501549082, 47.533935546875, 2.7141571044921875, -69.757003784179688], [-0.0095692880562858428, -0.011815466431801279, 7.7529969272281045e-05, 0.012919440239534251, -0.0090867677244630372, -0.9994673746489281, 47.577218134186708, 2.67438346047979, -69.584543688585057], [-0.010742233908370069, -0.009366576203062825, -0.0011297615252793716, 0.0116357846869797, -0.0082100707374386118, -1.0000291978807871, 47.577610224030458, 2.7535856089172936, -69.584704821397565], [-0.0096535863418656751, -0.011617362332354896, -0.0011040022210969446, 0.01162738795062295, -0.0093343806972232667, -1.0011104828456663, 47.535049438476562, 2.9391632080078125, -69.757461547851562], [-0.01062867591050624, -0.010665161217440326, -0.001119060290051296, 0.0087432861328125, -0.011199951171875, -1.0002593994140625, 47.609649658203125, 2.789306640625, -69.532867431640625], [-0.0085067018255869219, -0.010654040670202815, 5.7368387286929066e-05, 0.0073883707504254258, -0.0073182449368444091, -1.0005073358077037, 47.540910798904427, 2.7208849358545364, -69.532074566528522], [-0.0090847562054324343, -0.01066310231307525, -0.0011059046280524768, 0.011776290090460509, -0.008942621645720147, -1.0016275047359611, 47.534271240234375, 2.7147216796875, -69.532012939453125], [-0.0088145417577927838, -0.01066069545823115, -0.00077546522855867982, 0.012276106830892549, -0.00933097700639203, -1.0012547864412007, 47.708145952698608, 2.7135645794046335, -69.609089118847379], [-0.0076940108201183346, -0.010714670503848747, -0.00014892137722741409, 0.0138702392578125, -0.0081527099609375007, -1.0005105108963817, 47.360171508789065, 2.7154943847656252, -69.605347290039063]])

T_in= dtensor(readingsNormalized.reshape(50,3,3))
T_out, fit, itr, _ = als(T_in, 3)

"\n".join(
  [ ",".join([ str(k) for k in n ]) for n in T_out.U[0]  ] +
  [ ",".join([ str(k) for k in n ]) for n in T_out.U[1]  ] +
  [ ",".join([ str(k) for k in n ]) for n in T_out.U[2]  ] +
  [",".join([ str(n) for n in T_out.lmbda ])]
)